import streamlit as st
import yfinance as yf
import pandas as pd

# í˜ì´ì§€ ì„¤ì •
st.set_page_config(page_title="ì‹¤ì‹œê°„ ê¸ˆ ì‹œì„¸ ê³„ì‚°ê¸°", layout="centered")

st.title("ğŸ’° ì‹¤ì‹œê°„ ê¸ˆ 1ëˆ ì‹œì„¸")

@st.cache_data(ttl=600)  # 10ë¶„ë§ˆë‹¤ ë°ì´í„° ê°±ì‹ 
def get_data():
    # ê¸ˆ(GC=F) ë° í™˜ìœ¨(KRW=X) ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
    gold = yf.Ticker("GC=F")
    exchange = yf.Ticker("KRW=X")
    
    # ìµœê·¼ 30ì¼ ë°ì´í„° (ì°¨íŠ¸ìš©)
    gold_hist = gold.history(period="1mo")
    ex_hist = exchange.history(period="1mo")
    
    current_gold = gold_hist['Close'].iloc[-1]
    current_ex = ex_hist['Close'].iloc[-1]
    
    return current_gold, current_ex, gold_hist

gold_usd, krw_usd, history = get_data()

# 1ëˆ í™˜ì‚° ê³„ì‚°
# ê³µì‹: (1ì˜¨ìŠ¤ë‹¬ëŸ¬ * í™˜ìœ¨) / 31.1035 * 3.75
price_per_don = (gold_usd * krw_usd) / 31.1035 * 3.75

# ë©”ì¸ ì§€í‘œ ì¶œë ¥
col1, col2 = st.columns(2)
col1.metric("ê¸ˆ 1ëˆ (3.75g)", f"{int(price_per_don):,} ì›")
col2.metric("í˜„ì¬ í™˜ìœ¨", f"{krw_usd:.2f} ì›/$")

st.info(f"êµ­ì œ ê¸ˆ ì‹œì„¸: ${gold_usd:.2f} / t oz")

# ì°¨íŠ¸ ì‹œê°í™”
st.subheader("ğŸ“ˆ ìµœê·¼ 30ì¼ êµ­ì œ ê¸ˆ ì‹œì„¸ ì¶”ì´ ($)")
st.line_chart(history['Close'])

st.caption("ë°ì´í„° ì¶œì²˜: Yahoo Finance (10ë¶„ë§ˆë‹¤ ì—…ë°ì´íŠ¸)")